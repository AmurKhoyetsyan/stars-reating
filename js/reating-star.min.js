/**
 * Copyright (c) Amur 2023
 *
 * Reating Stars using pure js
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!function(){let t={};t.toBoolean=t=>"true"===t,t.isEmpty=t=>0===t.trim().length,t.itemStarPosition=[],t.starPositionSet=function(){for(let t=0;t<this.option.count;t++){let e=0===t?0:t*this.option.width;this.itemStarPosition.push({startX:e,endX:e+this.option.width,startY:0,endY:this.option.width})}},t.createStyle=function(){let t=document.getElementsByTagName("head"),e=document.querySelector('style[arm-star-reting="true"]');if(t&&!e){let r=document.createElement("style");r.setAttribute("type","text/css"),r.innerText=`.arm-star-reting-content-star,.arm-star-reting-content-star *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}.arm-star-reting-content-star{width:${this.option.width*this.option.count}px;height:${this.option.width}px}.arm-star-reting-content-star.arm-star-is-hover{cursor: pointer;}`,t[0].appendChild(r)}},t.polarToCartesian=function(t,e,r,i){let n=(i-90)*Math.PI/180;return{x:t+r*Math.cos(n),y:e+r*Math.sin(n)}},t.arc=function(t,e,r,i,n,o){let s=n-i==360,a=this.polarToCartesian(t,e,r,n-(s?.01:0)),l=this.polarToCartesian(t,e,r,i),u=["M",a.x,a.y,"A",r,r,0,n-i<=180?"0":"1",0,l.x,l.y,o&&!s?`L ${t} ${e} Z`:null,s&&!o?"Z":null].join(" ");return u},t.pie=function(t,e,r,i,n){return this.arc(t,e,r,i,n,!0)},t.star=function(t,e,r=10,i=5){let n=40*r/100,o=360/(2*i),s=Array(2*i).fill(0).map((i,s)=>{let a=this.polarToCartesian(t,e,s%2==0?r:n,o*s);return`${a.x},${a.y}`});return`M${s}Z`},t.isHover=function(t){let e=!!t.hasAttribute("arm-star-is-hover")&&t.getAttribute("arm-star-is-hover");return!this.isEmpty(e)&&this.toBoolean(e)},t.createSvg=function(t,e){let r=this,i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("height",r.option.width),i.setAttribute("width","100%"),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("class",`arm-star-reting-waveform-bg-${e}`);let n=t.hasAttribute("arm-star-data-percent")?parseFloat(t.getAttribute("arm-star-data-percent")):0,o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("height",r.option.width),o.setAttribute("width",`${n}%`),o.setAttribute("x",0),o.setAttribute("y",0),o.setAttribute("class",`arm-star-reting-progress-star-${e}`),o.setAttribute("fill",r.option.starColor);let s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("viewBox",`0 0 ${r.option.width*r.option.count} ${r.option.width}`),s.setAttribute("height",r.option.width),s.setAttribute("width","100%"),s.setAttribute("preserveaspectratio","none"),s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),s.setAttribute("class","arm-star-reting-waveform-container"),s.appendChild(i),s.appendChild(o);let a=document.createElement("div");a.classList.add("arm-star-reting-content-star"),r.isHover(t)&&a.classList.add("arm-star-is-hover"),a.setAttribute("arm-star-data-backup-percent",n);let l=document.createElement("style");l.setAttribute("type","text/css"),l.innerText=`.arm-star-reting-content-star .arm-star-reting-waveform-bg-${e} {-webkit-clip-path:url(#buckets${e});clip-path:url(#buckets${e});fill:${r.option.starEmptyColor}} .arm-star-reting-content-star .arm-star-reting-progress-star-${e} { -webkit-clip-path: url(#buckets${e}); clip-path: url(#buckets${e}); }`;let u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("height",0),u.setAttribute("width",0),u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),u.setAttribute("class","arm-star-reting-mask");let h=document.createElementNS("http://www.w3.org/2000/svg","defs"),c=document.createElementNS("http://www.w3.org/2000/svg","clipPath");c.setAttribute("id",`buckets${e}`);let p=r.option.count;r.option.width,r.option.width;let d=[];for(let $=0;$<p;$++)d.push($);let w="";w+=d.map((t,e)=>(0===e||r.option.width,`<path d=${r.star((e+.5)*r.option.width,r.option.width/2,r.option.width/2,r.option.points)} fill="${r.option.starColor}" />`)).join(""),c.innerHTML=w,s.innerHTML=s.innerHTML+d.map((t,e)=>(0===e||r.option.width,`<path d=${r.star((e+.5)*r.option.width,r.option.width/2,r.option.width/2,r.option.points)} fill="none" stroke="${r.option.stroke}" stroke-width="${r.option.strokeWidth}" data-index='${e}' />`)).join(""),h.appendChild(c),u.appendChild(h),a.appendChild(l),a.appendChild(s),a.appendChild(u),t.appendChild(a)},t.getPositionCursorInItem=function(t,e,r){let i=this;document.addEventListener("mousemove",function(n){let o=t.getBoundingClientRect();if(n.clientY>=o.y&&n.clientY<=o.y+o.height&&n.clientX>=o.x&&n.clientX<=o.x+o.width){let s=Math.ceil((n.clientX-o.x)/i.option.width),a=i.option.count*i.option.width,l=s*i.option.width;r(!0,s,100*l/a)}else t.querySelector(`.arm-star-reting-progress-star-${e}`).setAttribute("width",t.getAttribute("arm-star-data-backup-percent")+"%"),r(!1)},!0)},t.addFunctionalInRow=function(t,e){let r=this;if(r.isHover(t)){let i=t.querySelector(".arm-star-reting-content-star");if(null!==i){let n=t.querySelector(`.arm-star-reting-progress-star-${e}`);r.getPositionCursorInItem(i,e,function(t,o,s){i.onmouseover=function(e){e.stopPropagation(),e.preventDefault(),t&&n.setAttribute("width",s+"%")},null!==r.option.onclick&&(i.onclick=function(t){t.stopPropagation(),t.preventDefault(),r.option.onclick(o,e)})})}}},t.createStar=function(){let t=this,e=document.querySelectorAll(t.parent);e&&(e.forEach((e,r)=>{t.createSvg(e,r),t.addFunctionalInRow(e,r)}),t.starPositionSet())},t.mutator={option:{childList:!0,attributes:!0,characterData:!0,subtree:!0},observer:null,stars:null,olderStars:[],parent:null},t.mutator.setParent=function(t){this.parent=t},t.mutator.attrListString=function(t){let e="";if(0===t.length)return e;for(let r of t)e+=`${r.name}: ${r.value}; `;return e.trim()},t.mutator.equalsNode=function(t,e){let r=t.attributes,i=e.attributes;return r.length===i.length&&this.attrListString(r)===this.attrListString(i)},t.mutator.equals=function(){if(this.stars=document.querySelectorAll(this.parent.parent),null===this.stars||this.olderStars.length!==this.stars.length)return!1;for(let[t,e]of this.stars.entries())if(!this.equalsNode(e,this.olderStars[t]))return!1;return!0},t.mutator.removeAnotherStars=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.mutator.disconnect=function(){if(!this.observer)return!1;this.observer.disconnect()},t.mutator.cloneNodeList=function(t){this.olderStars=[],t.forEach((t,e)=>{this.olderStars.push(t.cloneNode(!0))})},t.mutator.addStars=function(){let t=document.querySelectorAll(this.parent.parent);null!==t&&(this.stars=t,this.cloneNodeList(t))},t.mutator.connect=function(){let t=this;t.observer=new MutationObserver((e,r)=>{t.stars&&!t.equals()&&(t.disconnect(),t.stars.forEach((e,r)=>t.removeAnotherStars(e)),t.addStars(),t.start())})},t.mutator.start=function(){let t=this;t.observer||(t.connect(),t.addStars()),t.stars.length>0&&(t.stars.forEach((e,r)=>{t.parent.createSvg(e,r),t.parent.addFunctionalInRow(e,r)}),t.parent.starPositionSet()),t.observer&&t.observer.observe(document,t.option)},t.run=function(t,e){for(let r in this.parent=t,this.option={width:20,onclick:null,count:5,strokeWidth:2,stroke:"rgba(0,0,0,1)",starColor:"rgb(255,200,0)",starEmptyColor:"#FFFFFF",points:5},e)this.option[r]=e[r];this.createStyle(),this.mutator.setParent(this),this.mutator.start()},window.StarReating=t}();