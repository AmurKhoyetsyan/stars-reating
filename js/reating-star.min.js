/**
 * Copyright (c) Amur 2023
 *
 * Reating Stars using pure js
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!function(){let t={};t.toBoolean=t=>"true"===t,t.isEmpty=t=>0===t.trim().length,t.itemStarPosition=[],t.starPositionSet=function(){for(let t=0;t<this.option.count;t++){let e=0===t?0:t*this.option.width;this.itemStarPosition.push({startX:e,endX:e+this.option.width,startY:0,endY:this.option.width})}},t.createStyle=function(){let t=document.getElementsByTagName("head"),e=document.querySelector('style[arm-star-reting="true"]');if(t&&!e){let r=document.createElement("style");r.setAttribute("type","text/css"),r.innerText=`.arm-star-reting-content-star,.arm-star-reting-content-star *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}.arm-star-reting-content-star{width:${this.option.width*this.option.count}px;height:${this.option.width}px}.arm-star-reting-content-star.arm-star-is-hover{cursor: pointer;}.arm-star-reting-mouse-over.arm-star-overed{cursor:pointer;fill:${this.option.starColor}}`,t[0].appendChild(r)}},t.polarToCartesian=function(t,e,r,i){let o=(i-90)*Math.PI/180;return{x:t+r*Math.cos(o),y:e+r*Math.sin(o)}},t.arc=function(t,e,r,i,o,s){let n=o-i==360,a=this.polarToCartesian(t,e,r,o-(n?.01:0)),l=this.polarToCartesian(t,e,r,i),u=["M",a.x,a.y,"A",r,r,0,o-i<=180?"0":"1",0,l.x,l.y,s&&!n?`L ${t} ${e} Z`:null,n&&!s?"Z":null].join(" ");return u},t.pie=function(t,e,r,i,o){return this.arc(t,e,r,i,o,!0)},t.star=function(t,e,r=10,i=5){let o=40*r/100,s=360/(2*i),n=Array(2*i).fill(0).map((i,n)=>{let a=this.polarToCartesian(t,e,n%2==0?r:o,s*n);return`${a.x},${a.y}`});return`M${n}Z`},t.isHover=function(t){let e=!!t.hasAttribute("arm-star-is-hover")&&t.getAttribute("arm-star-is-hover");return!this.isEmpty(e)&&this.toBoolean(e)},t.createSvg=function(t,e){let r=this,i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("height",r.option.width),i.setAttribute("width","100%"),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("class",`arm-star-reting-waveform-bg-${e}`);let o=t.hasAttribute("arm-star-data-percent")?parseFloat(t.getAttribute("arm-star-data-percent")):0,s=document.createElementNS("http://www.w3.org/2000/svg","rect");s.setAttribute("height",r.option.width),s.setAttribute("width",`${o}%`),s.setAttribute("x",0),s.setAttribute("y",0),s.setAttribute("class",`arm-star-reting-progress-star-${e}`),s.setAttribute("fill",r.option.starColor);let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",`0 0 ${r.option.width*r.option.count} ${r.option.width}`),n.setAttribute("height",r.option.width),n.setAttribute("width","100%"),n.setAttribute("preserveaspectratio","none"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("class","arm-star-reting-waveform-container"),n.appendChild(i),n.appendChild(s);let a=document.createElement("div");a.classList.add("arm-star-reting-content-star"),r.isHover(t)&&a.classList.add("arm-star-is-hover"),a.setAttribute("arm-star-data-backup-percent",o);let l=document.createElement("style");l.setAttribute("type","text/css"),l.innerText=`.arm-star-reting-content-star .arm-star-reting-waveform-bg-${e} {-webkit-clip-path:url(#buckets${e});clip-path:url(#buckets${e});fill:${r.option.starEmptyColor}} .arm-star-reting-content-star .arm-star-reting-progress-star-${e} { -webkit-clip-path: url(#buckets${e}); clip-path: url(#buckets${e}); }`;let u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttribute("height",0),u.setAttribute("width",0),u.setAttribute("xmlns","http://www.w3.org/2000/svg"),u.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),u.setAttribute("class","arm-star-reting-mask");let h=document.createElementNS("http://www.w3.org/2000/svg","defs"),c=document.createElementNS("http://www.w3.org/2000/svg","clipPath");c.setAttribute("id",`buckets${e}`);let p=r.option.count;r.option.width,r.option.width;let d=[];for(let m=0;m<p;m++)d.push(m);let $="";$+=d.map((t,e)=>(0===e||r.option.width,`<path d=${r.star((e+.5)*r.option.width,r.option.width/2,r.option.width/2,r.option.points)} fill="${r.option.starColor}" />`)).join(""),c.innerHTML=$,n.innerHTML=n.innerHTML+d.map((t,e)=>(0===e||r.option.width,`<path d=${r.star((e+.5)*r.option.width,r.option.width/2,r.option.width/2,r.option.points)} fill="none" stroke="${r.option.stroke}" class="arm-star-reting-mouse-over" stroke-width="${r.option.strokeWidth}" data-index='${e}' />`)).join(""),h.appendChild(c),u.appendChild(h),a.appendChild(l),a.appendChild(n),a.appendChild(u),t.appendChild(a)},t.getPositionCursorInItem=function(t,e,r){document.addEventListener("mousemove",function(i){let o=t.getBoundingClientRect();i.clientY>=o.y&&i.clientY<=o.y+o.height&&i.clientX>=o.x&&i.clientX<=o.x+o.width?r(!0):t.querySelector(`.arm-star-reting-progress-star-${e}`).setAttribute("width",t.getAttribute("arm-star-data-backup-percent")+"%")},!0)},t.addFunctionalInRow=function(t,e){let r=this;if(r.isHover(t)){let i=t.querySelectorAll(".arm-star-reting-mouse-over"),o=t.querySelector(".arm-star-reting-content-star");if(null!==o){let s=t.querySelector(`.arm-star-reting-progress-star-${e}`);r.getPositionCursorInItem(o,e,function(t){let o=r.option.count*r.option.width;i.forEach((n,a)=>{n.onmouseover=function(e){if(t){let n=r.itemStarPosition[a].endX;s.setAttribute("width",100*n/o+"%");for(let l=0;l<=a;l++)i.item(l).classList.contains("arm-star-overed")||i.item(l).classList.add("arm-star-overed")}},n.onmouseout=t=>{for(let e=0;e<=a;e++)i.item(e).classList.contains("arm-star-overed")&&i.item(e).classList.remove("arm-star-overed")},n.onclick=t=>{null!==r.option.onclick&&r.option.onclick(a,e)}})})}}},t.createStar=function(){let t=this,e=document.querySelectorAll(t.parent);e&&(e.forEach((e,r)=>{t.createSvg(e,r),t.addFunctionalInRow(e,r)}),t.starPositionSet())},t.mutator={option:{childList:!0,attributes:!0,characterData:!0,subtree:!0},observer:null,stars:null,olderStars:[],parent:null},t.mutator.setParent=function(t){this.parent=t},t.mutator.attrListString=function(t){let e="";if(0===t.length)return e;for(let r of t)e+=`${r.name}: ${r.value}; `;return e.trim()},t.mutator.equalsNode=function(t,e){let r=t.attributes,i=e.attributes;return r.length===i.length&&this.attrListString(r)===this.attrListString(i)},t.mutator.equals=function(){if(this.stars=document.querySelectorAll(this.parent.parent),null===this.stars||this.olderStars.length!==this.stars.length)return!1;for(let[t,e]of this.stars.entries())if(!this.equalsNode(e,this.olderStars[t]))return!1;return!0},t.mutator.removeAnotherStars=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.mutator.disconnect=function(){if(!this.observer)return!1;this.observer.disconnect()},t.mutator.cloneNodeList=function(t){this.olderStars=[],t.forEach((t,e)=>{this.olderStars.push(t.cloneNode(!0))})},t.mutator.addStars=function(){let t=document.querySelectorAll(this.parent.parent);null!==t&&(this.stars=t,this.cloneNodeList(t))},t.mutator.connect=function(){let t=this;t.observer=new MutationObserver((e,r)=>{t.stars&&!t.equals()&&(t.disconnect(),t.stars.forEach((e,r)=>t.removeAnotherStars(e)),t.addStars(),t.start())})},t.mutator.start=function(){let t=this;t.observer||(t.connect(),t.addStars()),t.stars.length>0&&(t.stars.forEach((e,r)=>{t.parent.createSvg(e,r),t.parent.addFunctionalInRow(e,r)}),t.parent.starPositionSet()),t.observer&&t.observer.observe(document,t.option)},t.run=function(t,e){for(let r in this.parent=t,this.option={width:20,onclick:null,count:5,strokeWidth:2,stroke:"rgba(0,0,0,1)",starColor:"rgb(255,200,0)",starEmptyColor:"#FFFFFF",points:5},e)this.option[r]=e[r];this.createStyle(),this.mutator.setParent(this),this.mutator.start()},window.StarReating=t}();