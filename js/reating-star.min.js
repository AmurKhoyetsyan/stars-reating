/**
 * Copyright (c) Amur 2023
 *
 * Reating Stars using pure js
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!function(){let t={};t.createStyle=function(){let t=document.getElementsByTagName("head"),e=document.querySelector('style[arm-star-reting="true"]');if(t&&!e){let r=document.createElement("style");r.setAttribute("type","text/css"),r.innerText=`.arm-star-reting-content-star:hover svg rect {display: none;} .arm-star-reting-content-star,.arm-star-reting-content-star *{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;margin:0;padding:0}.arm-star-reting-content-star{width:${this.option.width*this.option.count}px;height:${this.option.width}px}.arm-star-reting-mouse-over{cursor:pointer;}.arm-star-reting-mouse-over.arm-star-overed{cursor:pointer;fill:${this.option.starColor}}`,t[0].appendChild(r)}},t.polarToCartesian=function(t,e,r,i){let s=(i-90)*Math.PI/180;return{x:t+r*Math.cos(s),y:e+r*Math.sin(s)}},t.arc=function(t,e,r,i,s,o){let n=s-i==360,a=this.polarToCartesian(t,e,r,s-(n?.01:0)),l=this.polarToCartesian(t,e,r,i),h=["M",a.x,a.y,"A",r,r,0,s-i<=180?"0":"1",0,l.x,l.y,o&&!n?`L ${t} ${e} Z`:null,n&&!o?"Z":null].join(" ");return h},t.pie=function(t,e,r,i,s){return this.arc(t,e,r,i,s,!0)},t.star=function(t,e,r=10,i=5){let s=40*r/100,o=360/(2*i),n=Array(2*i).fill(0).map((i,n)=>{let a=this.polarToCartesian(t,e,n%2==0?r:s,o*n);return`${a.x},${a.y}`});return`M${n}Z`},t.createSvg=function(t,e){let r=this,i=document.createElementNS("http://www.w3.org/2000/svg","rect");i.setAttribute("height",r.option.width),i.setAttribute("width","100%"),i.setAttribute("x",0),i.setAttribute("y",0),i.setAttribute("class",`arm-star-reting-waveform-bg-${e}`);let s=t.hasAttribute("arm-star-data-percent")?parseFloat(t.getAttribute("arm-star-data-percent")):0,o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("height",r.option.width),o.setAttribute("width",`${s}%`),o.setAttribute("x",0),o.setAttribute("y",0),o.setAttribute("class",`arm-star-reting-progress-star-${e}`),o.setAttribute("fill",r.option.starColor);let n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.setAttribute("viewBox",`0 0 ${r.option.width*r.option.count} ${r.option.width}`),n.setAttribute("height",r.option.width),n.setAttribute("width","100%"),n.setAttribute("preserveaspectratio","none"),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),n.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),n.setAttribute("class","arm-star-reting-waveform-container"),n.appendChild(i),n.appendChild(o);let a=document.createElement("div");a.classList.add("arm-star-reting-content-star");let l=document.createElement("style");l.setAttribute("type","text/css"),l.innerText=`.arm-star-reting-content-star .arm-star-reting-waveform-bg-${e} {-webkit-clip-path:url(#buckets${e});clip-path:url(#buckets${e});fill:${r.option.starEmptyColor}} .arm-star-reting-content-star .arm-star-reting-progress-star-${e} { -webkit-clip-path: url(#buckets${e}); clip-path: url(#buckets${e}); }`;let h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("height",0),h.setAttribute("width",0),h.setAttribute("xmlns","http://www.w3.org/2000/svg"),h.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),h.setAttribute("class","arm-star-reting-mask");let u=document.createElementNS("http://www.w3.org/2000/svg","defs"),c=document.createElementNS("http://www.w3.org/2000/svg","clipPath");c.setAttribute("id",`buckets${e}`);let p=r.option.count;r.option.width,r.option.width;let d=[];for(let m=0;m<p;m++)d.push(m);let $="";$+=d.map((t,e)=>(r.option.width,`<path d=${r.star((e+.5)*r.option.width,r.option.width/2,r.option.width/2,r.option.points)} fill="${r.option.starColor}" />`)).join(""),c.innerHTML=$,n.innerHTML=n.innerHTML+d.map((t,e)=>(r.option.width,`<path d=${r.star((e+.5)*r.option.width,r.option.width/2,r.option.width/2,r.option.points)} fill="none" stroke="${r.option.stroke}" class="arm-star-reting-mouse-over" stroke-width="${r.option.strokeWidth}" data-index='${e}' />`)).join(""),u.appendChild(c),h.appendChild(u),a.appendChild(l),a.appendChild(n),a.appendChild(h),t.appendChild(a)},t.addFunctionalInRow=function(t,e){let r=this,i=t.querySelectorAll(".arm-star-reting-mouse-over");i.forEach((t,s)=>{t.onmouseover=t=>{for(let e=0;e<=s;e++)i.item(e).classList.contains("arm-star-overed")||i.item(e).classList.add("arm-star-overed")},t.onmouseout=t=>{for(let e=0;e<=s;e++)i.item(e).classList.contains("arm-star-overed")&&i.item(e).classList.remove("arm-star-overed")},t.onclick=t=>{null!==r.option.onclick&&r.option.onclick(s,e)}})},t.createStar=function(){let t=this,e=document.querySelectorAll(t.parent);e&&e.forEach((e,r)=>{t.createSvg(e,r),t.addFunctionalInRow(e,r)})},t.mutator={option:{childList:!0,attributes:!0,characterData:!0,subtree:!0},observer:null,stars:null,olderStars:[],parent:null},t.mutator.setParent=function(t){this.parent=t},t.mutator.attrListString=function(t){let e="";if(0===t.length)return e;for(let r of t)e+=`${r.name}: ${r.value}; `;return e.trim()},t.mutator.equalsNode=function(t,e){let r=t.attributes,i=e.attributes;return r.length===i.length&&this.attrListString(r)===this.attrListString(i)},t.mutator.equals=function(){if(this.stars=document.querySelectorAll(this.parent.parent),this.olderStars.length!==this.stars.length)return!1;for(let[t,e]of this.stars.entries())if(!this.equalsNode(e,this.olderStars[t]))return!1;return!0},t.mutator.removeAnotherStars=function(t){for(;t.firstChild;)t.removeChild(t.firstChild)},t.mutator.disconnect=function(){if(!this.observer)return!1;this.observer.disconnect()},t.mutator.cloneNodeList=function(t){this.olderStars=[],t.forEach((t,e)=>{this.olderStars.push(t.cloneNode(!0))})},t.mutator.addStars=function(){let t=document.querySelectorAll(this.parent.parent);this.stars=t,this.cloneNodeList(t)},t.mutator.connect=function(){let t=this;t.observer=new MutationObserver((e,r)=>{t.stars&&!t.equals()&&(t.disconnect(),t.stars.forEach((e,r)=>t.removeAnotherStars(e)),t.addStars(),t.start())})},t.mutator.start=function(){this.observer||(this.connect(),this.addStars()),this.stars.length>0&&this.stars.forEach((t,e)=>{this.parent.createSvg(t,e),this.parent.addFunctionalInRow(t,e)}),this.observer&&this.observer.observe(document,this.option)},t.run=function(t,e){for(let r in this.parent=t,this.option={width:20,onclick:null,count:5,strokeWidth:2,stroke:"rgba(0,0,0,1)",starColor:"rgb(255,200,0)",starEmptyColor:"#FFFFFF",points:5},e)this.option[r]=e[r];this.createStyle(),this.mutator.setParent(this),this.mutator.start()},window.StarReating=t}();